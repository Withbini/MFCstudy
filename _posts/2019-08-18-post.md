---
title: "Windows 시스템 프로그래밍 정리-명령어 구성 및 커널 오브젝트"
date: 2019-08-18
---
들어가기에 앞서 설명할 내용은 컴퓨터구조에서 배웠던 ARM을 바탕으로 한 명령어 개념을 가지고 있으나, 실제 어셈블리 코드와는 다르다는 것을 먼저 알리고자 한다.


컴퓨터 구조-명령어
=====
#### Computer design
만약 컴퓨터를 디자인한다고 했을때 H/W 디자이너(보통의 경우 ASIC), Algorithm 디자이너, Interface 전문가, 프로그램 전문가 등 
다양한 집단의 사람이 참여한다.
이 중 프로그램 전문가는 보통 S/W인데, 이들은 주로 instruction set과 register에 관한 세부사항을 정한다.

### 명령어
명령어의 경우 명령어에 따라 명령어 조합이 달라진다.
예를 들어, 사칙연산 명령어는 "연산자 destination operand1 operand2"로 구성되어
피연산자1과 피연산자2를 연산자에 맞춰 계산하여 destination 으로 보낸다는 의미를 담고 있다.


이 때, destination에 올 수 있는 것은 레지스터뿐이고 피연산자에 들어갈 수 있는 대상은 레지스터와 숫자 둘 다 가능하다.
하지만 레지스터와 숫자에 들어갈 수 있는 수가 제한되어 있다. 또한 메모리주소를 가져와 연산하는 것도 제한되어 있다.
이런 제약을 가진 이유는 이 시스템이 RISC를 따르기 때문이다.
RISC는 명령어의 갯수를 줄이고 여러 제약조건을 가진 대신 "파이프라이닝"을 통해 효율성을 높일 수 있기에 유용하고 지금까지 많은 시스템에서 사용하고 있다.


그렇다면 메모리 주소를 가져와 연산하고 싶은 경우에는 어떻게 해야할까?
이 경우에는 사칙연산과 다른 또다른 연산이 필요하다. 그것이 바로 load&store인데, load와 store를 통해 메모리 주소를 가지고 직접적
연산이 가능하다. 즉 다시 말해서 메인 메모리에서 CPU 레지스터로 데이터를 가져오거나 그 반대의 것이 load&store 연산자를 통해 가능해졌다.
load의 경우 명령어는 "load연산자 destination source"로 표현된다.
이 때 source는 메인 메모리 특정 주소의 데이터를 destination 레지스터로 보낸다는 의미를 가진다.
~~~.asm
LOAD r1 0x100 //256번지 데이터를 r1에 저장하시오
~~~

store의 경우 명령어는 "store연산자 source destination으로 표현된다.
이 때 source는 레지스터의 있는 데이터를 메모리의 특정 주소로 보낸다는 의미를 가지고 있다.
~~~.asm
STORE r1 0x100 //r1데이터를 256번지에 저장하시오
~~~


#### direct VS indirect

메모리 주소 addressing과 관련하여 얘기할 주제는 direct address와 indirect address이다.
direct address는 직접적으로 메모리주소 내 내용을 가져오는 것을 의미한다. rough하게 예를 들어보자.
32비트 시스템에서는
* 2^32=4GB 주소까지 메모리 주소에 접근할 수 있다. 
* 또한 명령어의 길이는 32비트이다.
* load 명령어 source 길이는 32비트보다 작다.

위 사실을 받아들인다면, 메인 메모리의 모든 영역에 접근할 수 없음을 알 수 있다.
source인 메인 메모리의 주소값이 32비트보다 작으므로 4GB보다 작은 숫자의 메모리 주소에 접근할 수 있고,
그보다 큰 숫자의 메모리 주소에는 접근할 수 없다는 의미이다.

direct address 방식은 위와 같은 문제점을 가지고 있다.


그래서 나온것이 바로 indirect 방식이다.
indirect 방식은 direct 방식과 다르게 메모리 주소가 참조하고 있는 메모리 주소가 가진 데이터를 참조한다.
즉, 포인터의 개념이라고 생각하면 될 것이다. 다음과 같은 명령어를 보면 이해가 될 것이다.
~~~.asm
LOAD r1 [0x100] //256번지가 가리키는 메모리 주소의 데이터를 가져와 r1에 저장하시오
~~~

물론 direct 모드로 할 것인지 indirect 모드로 할 것인지에 대한 비트도 필요한 것은 당연하다.
